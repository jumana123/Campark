{"version":3,"file":"svelte-google-maps.js","sources":["../src/utils.js","../src/context.js","../src/index.js"],"sourcesContent":["let loading;\n\nexport async function load(url) {\n  if (window.google && window.google.maps) return google.maps;\n  if (loading) return loading;\n\n  loading = new Promise((resolve, reject) => {\n    window.__SvelteGoogleMapsInit = () => resolve(google.maps);\n\n    const src = url + '&callback=__SvelteGoogleMapsInit';\n    const script = document.createElement('script');\n    script.onerror = () => reject(new Error(`Failed to load google maps scripts (${src})`));\n    script.async = true;\n    script.defer = true;\n    script.charset = 'utf-8';\n    script.src = src;\n\n    const firstScript = document.getElementsByTagName(\"script\")[0];\n    firstScript.parentNode.insertBefore(script, firstScript);\n  });\n\n  return loading;\n}\n\nexport function deferred() {\n  let _resolve, _reject;\n  \n  const later = new Promise((resolve, reject) => {\n    _resolve = resolve;\n    _reject = reject;\n  });\n\n  later.resolve = _resolve;\n  later.reject = _reject;\n\n  return later;\n}\n\nexport function changer() {\n  let changing = false;\n\n  return callback => {\n    if (changing) return;\n\n    changing = true;\n    callback();\n    changing = false;\n  };\n}\n\nexport function defer(callback) {\n  setTimeout(callback, 0);\n}\n","import { load, deferred } from './utils';\n\nexport default class Context {\n  constructor(API_KEY, options = {}) {\n    const { beta = false } = options;\n    window.API_KEY = API_KEY;\n    this.url = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}${\n      beta ? '&v=3.exp&use_slippy=true' : ''\n    }`;\n\n    this.api = deferred();\n    this.map = deferred();\n  }\n\n  async load(element, options) {\n    const api = await load(this.url);\n    const map = new api.Map(element, options);\n\n    this.api.resolve(api);\n    this.map.resolve(map);\n\n    return { api, map };\n  }\n\n  async ready() {\n    const api = await this.api;\n    const map = await this.map;\n\n    return { api, map };\n  }\n}\n","// Assume ES Modules usage is with svelte compiler\n// so import components separately to avoid bundling unneeded code\n//\n// Example:\n//\n// import { Context } from 'svelte-google-maps';\n// import Map from 'svelte-google-maps/Map.html';\n// import Marker from 'svelte-google-maps/Marker.html';\n\nexport { default as Context } from './context';\n"],"names":[],"mappings":"AAAA,IAAI,OAAO,CAAC;;AAEZ,AAAO,eAAe,IAAI,CAAC,GAAG,EAAE;EAC9B,IAAI,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,MAAM,CAAC,IAAI,CAAC;EAC5D,IAAI,OAAO,EAAE,OAAO,OAAO,CAAC;;EAE5B,OAAO,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;IACzC,MAAM,CAAC,sBAAsB,GAAG,MAAM,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;;IAE3D,MAAM,GAAG,GAAG,GAAG,GAAG,kCAAkC,CAAC;IACrD,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;IAChD,MAAM,CAAC,OAAO,GAAG,MAAM,MAAM,CAAC,IAAI,KAAK,CAAC,CAAC,oCAAoC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACxF,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;IACpB,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;IACpB,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC;IACzB,MAAM,CAAC,GAAG,GAAG,GAAG,CAAC;;IAEjB,MAAM,WAAW,GAAG,QAAQ,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;IAC/D,WAAW,CAAC,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;GAC1D,CAAC,CAAC;;EAEH,OAAO,OAAO,CAAC;CAChB;;AAED,AAAO,SAAS,QAAQ,GAAG;EACzB,IAAI,QAAQ,EAAE,OAAO,CAAC;;EAEtB,MAAM,KAAK,GAAG,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;IAC7C,QAAQ,GAAG,OAAO,CAAC;IACnB,OAAO,GAAG,MAAM,CAAC;GAClB,CAAC,CAAC;;EAEH,KAAK,CAAC,OAAO,GAAG,QAAQ,CAAC;EACzB,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;;EAEvB,OAAO,KAAK,CAAC;CACd;;AClCc,MAAM,OAAO,CAAC;EAC3B,WAAW,CAAC,OAAO,EAAE,OAAO,GAAG,EAAE,EAAE;IACjC,MAAM,EAAE,IAAI,GAAG,KAAK,EAAE,GAAG,OAAO,CAAC;IACjC,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC;IACzB,IAAI,CAAC,GAAG,GAAG,CAAC,4CAA4C,EAAE,OAAO,CAAC;MAChE,IAAI,GAAG,0BAA0B,GAAG,EAAE;KACvC,CAAC,CAAC;;IAEH,IAAI,CAAC,GAAG,GAAG,QAAQ,EAAE,CAAC;IACtB,IAAI,CAAC,GAAG,GAAG,QAAQ,EAAE,CAAC;GACvB;;EAED,MAAM,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE;IAC3B,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACjC,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;;IAE1C,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IACtB,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;;IAEtB,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;GACrB;;EAED,MAAM,KAAK,GAAG;IACZ,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC;IAC3B,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,GAAG,CAAC;;IAE3B,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;GACrB;CACF;;AC9BD;;;;;;;uDAOuD;;;;"}